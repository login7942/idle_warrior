# 📜 Idle Warrior Adventure - 게임 기획 및 설계 문서 (Game Design Document)

이 문서는 게임의 세계관, 핵심 시스템 규칙, 아이템 구조 및 전투 공식을 정리한 기획 표준서입니다.

---

## 1. 게임 명칭 및 세계관 (Terminology)

### 1.1. 주요 화면 및 탭
| 앱 명칭 | 코드 ID | 한글 명칭 | 설명 |
| :--- | :--- | :--- | :--- |
| **Battle** | `battle` | **전투** | 메인 자동 사냥 화면, 성장 효율 대시보드 포함 |
| **Character** | `character` | **캐릭터** | 상세 스탯 정보 및 CP(전투력) 확인 |
| **Map** | `map` | **사냥터** | 일반 사냥터 이동 및 특수 던전 입장 |
| **Inventory** | `inventory` | **가방** | 보유 장비 확인, 분해, 합성, 강화 수행 |
| **Craft** | `craft` | **제작** | 대장간 시스템, 티어별 확정/랜덤 장비 제작 |
| **Prestige** | `prestige` | **유물** | 환생 포인트(PP)를 이용한 유물 소환 및 강화 |
| **Achievement** | `achievement` | **업적** | 도전 과제 확인 및 누적 영구 스탯 보상 수령 |
| **Skill** | `skill` | **스킬** | 액티브/패시브 스킬 트리 습득 및 강화 |
| **Pet** | `pet` | **펫** | 동료 펫 소환 및 효과 관리 (보유 효과 요약 UI 포함) |

---

## 2. 아이템 및 장비 체계 (Item System)

### 2.1. 장비 티어 및 등급 (Tier & Rarity)
현재 시스템은 **티어(Tier) 기반**으로 등급이 1:1 매칭되어 관리됩니다.

| 티어 | 명칭 (Rarity) | 색상 | 슬롯 수 | 재료 |
| :---: | :--- | :--- | :---: | :--- |
| **1** | T1 (일반) | `#94a3b8` (회색) | 0~1 | T1 조각 |
| **2** | T2 (고급) | `#22c55e` (초록) | 1~2 | T2 조각, 철광석 |
| **3** | T3 (마법) | `#3b82f6` (파란) | 2~3 | T3 조각, 은광석 |
| **4** | T4 (영웅) | `#a855f7` (보라) | 3~4 | T4 조각, 금광석 |
| **5** | T5 (고유) | `#eab308` (노랑) | 4~5 | T5 조각, 다이아 |
| **6** | T6 (전설) | `#ef4444` (빨강) | 5~6 | T6 조각, 다이아 |
| **-** | Mythic (신화) | `#ff0000` (진홍) | 6 | 특수 |

### 2.2. 강화 및 내구도 (Enhancement & Durability)
*   **최대 강화**: +20
*   **승급 (Promotion)**: +20 달성 시 재료를 소모하여 다음 티어 +10 장비로 진화.
*   **내구도 실패 패널티**:
    *   11강 이후 실패 시 내구도가 5~25씩 감소.
    *   내구도가 0이 되면 **파손** 상태가 되며, 기본 스탯이 80%로 감소하고 강화가 불가능해짐.
*   **계승 시스템**: 파손 시 강화 수치의 70%가 슬롯에 저장되어, 나중에 동일 티어 새 장비 제작 시 즉시 주입됨.

### 2.3. 잠금 시스템 (Lock System)
*   **아이템 잠금 (Item Lock)**:
    *   **목적**: 핵심 장비의 실수에 의한 손실 및 변형 방지.
    *   **제한 사항**: 잠금 상태에서는 **분해, 옵션 재설정, 강화, 승급, 잠재력 개방**이 모두 차단됨.
*   **옵션 잠금 (Affix Lock)**:
    *   **목적**: 옵션 재설정(Reforge) 시 원하는 특정 수치 보존.
    *   **제한 사항**: 잠금된 옵션은 재설정 시 무작위 변경에서 제외되지만, 개당 **마법 가루**가 추가로 소모됨.

### 2.4. 상세 정보창 내비게이션 (Navigation UX)
*   **탐색 방식**:
    *   **화살표 버튼**: 아이템 이름 좌우에 배치된 버튼으로 이전/다음 아이템 전환.
    *   **스와이프 (Swipe)**: 화면 좌측/우측 드래그로 전환 (모바일 환경 가독성 중점).
*   **지능형 컨텍스트 (Context-Awareness)**:
    *   **인벤토리 진입 시**: 현재 적용된 **필터(분류) 및 정렬 조건**이 유지된 상태로 목록을 탐색.
    *   **착용 아이템 클릭 시**: 가방 목록이 아닌, 현재 **착용 중인 모든 부위(무기~목걸이)**를 대상으로 순환 탐색.
    *   **헤더 가이드**: 현재 목록에서의 순번(`현재 인덱스 / 전체 개수`)을 실시간 표시.

---

## 3. 전투 및 성장 로직 (Combat & Growth)

### 3.1. 데미지 및 방어력 공식 (Damage & Defense)
*   **방어 상산 방식 (Soft Cap)**: `데미지 배율 = 100 / (100 + 실질 방어력)`
*   **실질 방어력**: `몬스터 방어력 * (1 - 방어 관통 %)`
*   **최종 데미지**: `공격력 * 데미지 배율` (단, 공격력의 최소 10%는 항상 보장하여 '0 데미지' 방지)
*   **공격 구조 (Round Robin)**:
    *   **단일 행동**: 한 턴에 오직 하나의 행동(스킬 또는 기본공격)만 실행. (행동 중복 방지)
    *   **스킬 우선권**: 사용 가능한 스킬이 있으면 우선 사용, 없을 때만 기본공격 실행.
    *   **라운드 로빈**: 스킬은 고정된 순서대로 확인하며, 행동(스킬/기본공격) 수행 후에도 탐색 인덱스를 유지하여 엄격한 순환 구조를 보장합니다.
*   **공격 속도 (Attack Speed)**:
    *   **역할**: "타격 횟수"가 아닌 **"전투 턴의 주기"**를 단축. (AS ↑ = 턴 주기 ↓)
    *   **하드 캡**: 안정성을 위해 초당 최대 4회(최소 주기 250ms)로 제한.
    *   **첫 타격 지연**: 몬스터 스폰 후 첫 공격도 공격 속도에 따른 턴 주기가 경과한 후에 실행됩니다. (선공권 보정)
*   **쾌속 등반 (Jump)**: 
    *   **조건**: 몬스터 처치 속도가 1.5초 미만일 경우 현재 스테이지 +1 점프.
    *   **제한**: **보스 스테이지(50의 배수)**에서는 보스전 기회 보장을 위해 점프가 발생하지 않습니다.

### 3.2. 확률 및 강화 시스템 (Probabilities)

#### 🚀 강화 성공 확률 (Enhancement)
*   **T1 기준**: 1~5강(100%), 10강(70%), 15강(25%), 20강(3%)
*   **페널티**: 11강 이후 실패 시 내구도 감소 (-5 ~ -25). 내구도 0 시 **파손**.

#### 💎 장비 계승 시스템 (Inheritance) - **중요**
*   **보존**: 장비가 파손될 경우, 해당 장비 강화 수치의 **70%**를 티어별 '계승 슬롯'에 저장합니다. (예: +20강 파손 시 +14 보존)
*   **적용**: 동일 티어의 새로운 장비를 강화할 때, 계승 슬롯의 수치가 장비의 현재 강화도보다 높으면 **즉시 무료로 계승**됩니다.

#### 🛠️ 승급 확률 및 천장 (Promotion)
*   **확률**: T1(30%), T2(15%), T3(7%), T4(3%), T5(1%)
*   **보정(Pity)**: 3회 실패 시 다음 시도는 **100% 성공**.

#### 📦 드랍 확률 (Drop Rates)
*   **기본 장비**: 몬스터 처치 시 15%
*   **강화 재료**: 메인(10%), 서브(5%) / 정예·보스는 4~5배 가중치
*   **광석(Core)**: 철(80%), 은(10%), 금(7%), 다이아(3%)
*   **초희귀**: 강화 보호권 (0.5%)

### 3.3. 몬스터 성장 공식 (Monster Scaling)
몬스터의 HP, 공격력, 방어력은 스테이지(S)에 따라 3단계로 구분되어 성장합니다.

1.  **1구간 (S ≤ 200)**: [선형] `Multiplier = 1 + (S * 0.15)`
2.  **2구간 (200 < S ≤ 1500)**: [지수] `Multiplier = 31 * Math.pow(1.065, (S - 200) / 10)`
3.  **3구간 (S > 1500)**: [강한 지수 + 벽] `Multiplier = 85000 * Math.pow(1.1, (S - 1500) / 50) * (1 + Floor((S - 1500) / 100) * 0.5)`

### 3.3. 드랍 및 보상 시스템
*   **보상 배율**: `스테이지 배율 * (1 + 층수 / 500)` (고스테이지일수록 골드/경험치 효율 가속화)
*   **메인 드랍**: 마법 가루, 강화석 (약 10%)
*   **서브 드랍**: 재설정석, 잠재의 큐브 (약 5%)
*   **보스/엘리트**: 드랍 확률 4~5배 가중치 적용.
*   **초희귀**: 강화 보호권 (0.5%)

---

### 3.3. 주인공 성장 곡선 (Character Growth)

#### 📈 레벨업 요구 경험치 (Leveling)
*   **공식**: `다음 레벨 경험치 = 현재 단계 경험치 * 1.15`
*   레벨이 올라갈수록 요구 경험치가 **15%씩 복리로 증가**하는 구조입니다.

#### 📊 레벨업 능력치 상승 (Stat Gains)
레벨업 시 순수 기반 능력치(Base Stats)가 다음과 같이 영구 상승합니다.
*   **공격력(ATK)**: +2
*   **체력(HP)**: +30
*   **방어력(DEF)**: +0.5

#### 🧮 최종 스탯 계산 공식 (Total Stat Formula)
아이템, 유물, 업적, 펫의 효과가 합산되어 최종 스탯이 결정됩니다.
*   **공격력**: `(기본 + 합산고정) * (1 + 합산비율) * 유물배율 * 펫배율`
*   **방어력**: `(기본 + 합산고정) * (1 + 합산비율) * 유물배율`
*   **최대 체력**: `(기본 + 합산고정) * (1 + 합산비율) * 유물배율`
*   **전투력(CP)**: `공격력 * 공격속도 * (1 + 치명타확률 * (치명타피해 - 1))`

---

## 4. 수동 방치 모드 (Manual Idle)
*   **작동 방식**: 사용자가 직접 [방치모드]를 켰을 때만 작동.
*   **효율 계산**: 시작 시점의 **GPM/EPM/KPM 스냅샷**을 기반으로 누적 시간 보상 지급.
*   **한도**: 최대 5시간까지 보상 누적 가능.

---

---

## 5. 스킬 시스템 및 해금 (Skills)
*   **레벨업 비용**: `기본 비용 * Math.pow(비용배율, 현재레벨)` (배율은 1.5 ~ 3.5 사이)
*   **쿨타임 관리**: `최종 쿨타임 = 기본 쿨타임 * (1 - 쿨타임 감소 %)`
*   **해금 레벨**: 유저가 특정 레벨에 도달하면 골드를 소모하여 습득 가능.

| 해금 레벨 | 스킬 명칭 | 유형 | 특징 |
| :---: | :--- | :---: | :--- |
| **5** | 바람 베기 | 액티브 | 초반 주력기 (3연타) |
| **10** | 광폭화 | 패시브 | 공격 속도 영구 증가 |
| **15** | 강격 | 액티브 | 강력한 한방 데미지 |
| **20** | 철벽 | 패시브 | 방어력 비율 증가 |
| **30** | 얼음 화살 | 액티브 | 고위력 및 빙결 효과 |
| **45** | 탐욕의 시선 | 패시브 | 골드/아이템 획득량 증가 |
| **60** | 화염구 | 액티브 | 광역 마법형 고데미지 |
| **80** | 약점 노출 | 패시브 | 치명타 피해량 대폭 증가 |
| **120** | 메테오 | 액티브 | 최종 결전기 (초고화력) |
| **160** | 흡혈의 손길 | 패시브 | 데미지 비례 체력 흡수 |
| **200** | 신속 | 패시브 | 모든 스킬 재사용 대기시간 감소 |

---

## 6. 장비 도감 시스템 (Equipment Encyclopedia)
*   **작동 방식**: 획득 및 강화에 성공한 아이템의 최고 강화 단계가 자동으로 기록됩니다.
*   **보상 체계**:
    *   **T1 ~ T4**: 단계별 고정 수치 보너스 (공격력/HP) 합산 적용.
    *   **T5 ~ T6**: 단계별 퍼센트(%) 비율 보너스 합산 적용.
*   **편의 기능**:
    *   **일괄 수령**: 미수령한 모든 도감 보상을 한 번에 수령 가능.
    *   **총 효과 요약**: 도감으로 인해 상승한 총 능력치 합계를 요약 UI에서 상시 확인 가능.

---

## 7. 기타 시스템 정밀 로직 (Advanced Logic)

### 6.1. 환생 및 유물 (Prestige & Artifacts)
*   **환생 조건**: 최소 100 레벨 이상 달성 시 가능.
*   **포인트(PP) 획득**: `PP = (현재 레벨 - 100) + 1`
*   **유물 소환**: 10 PP를 소모하여 랜덤한 유물의 레벨을 1 올림 (중복 소환이 곧 레벨업).

### 6.2. 방치 보상 공식 (Offline Rewards)
*   **측정 효율 기반**: 세션 중 실시간으로 측정된 분당 효율(GPM/EPM/KPM)을 데이터에 저장하여 사용.
*   **보상 계산**: `획득량 = 경과 시간(분) * 측정 효율 * 방치 효율(기본 70%)`
*   **보정 로직**: 저장된 효율 데이터가 없는 경우를 대비한 '레벨 비례 최소 보상' 보장 시스템 적용.
*   **한도**: 최대 24시간(1440분)까지 누적 가능.

### 6.3. 효율 측정 (Efficiency Tracking)
*   **이동 평균**: 최근 60초간의 획득 내역을 기반으로 분당 효율을 계산.
*   **예열 시간**: 데이터 오염 방지를 위해 게임 시작 또는 사냥터 변경 후 70초간은 효율 측정을 보류(Warmup)함.

### 6.4. 아이템 생성 정밀 수식 (Item Generation)
*   **티어 스케일링**: 티어당 기본 스탯이 **4.0배**씩 지수로 성장함. (예: T2는 T1의 4배, T3은 16배)
*   **강화 복리**: 1~17강은 **12%**, 18강 이후는 **6%**씩 스탯이 **복리**로 증가함.
*   **파손 페널티**: 파손 상태가 되면 강화 보너스를 포함한 최종 스탯이 **20% 감소(0.8배)**함.
*   **결정론적 난수**: `seed` 기반 PRNG를 사용하여 동일한 아이템은 항상 같은 랜덤 옵션 수치를 유지함.

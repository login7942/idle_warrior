# 📜 Idle Warrior Adventure - 통합 게임 가이드 (System, Balance & Dev)

> **현재 버전**: v0.5.34 (2026-01-25)  
> **목표**: 게임의 모든 핵심 시스템, 밸런스 공식, 개발 가이드, 그리고 미래 로드맵을 하나의 문서로 관리하여 데이터 정합성을 유지합니다.

---

## 📂 1. 시스템 개요 및 인터페이스 (Terminology)

| 앱 명칭 | 한글 명칭 | 설명 |
| :--- | :--- | :--- |
| **Battle** | **전투** | 메인 자동 사냥 화면 및 실시간 효율 대시보드 |
| **Character** | **캐릭터** | 상세 스탯 및 전투력(CP) 확인 |
| **Map** | **사냥터** | 지역 이동 및 특수 던전(무한의 탑) 입장 |
| **Inventory** | **가방** | 장비 관리, 분해, 강화, 옵션 재설정 |
| **Craft** | **제작** | 통합 파편과 핵심 재료를 사용한 장비 제작 |
| **Artifact** | **유물** | 환생 포인트를 사용한 영구 능력치 강화 (준비 중) |
| **Achievement** | **업적** | 도전 과제 및 상시 보너스 수령 |
| **Skill** | **스킬** | 액티브/패시브 스킬 습득 및 강화 |
| **Pet** | **펫** | 동료 펫 소환 및 효과(보유/동행) 관리 |
| **System** | **설정** | 데이터 저장, 사운드, 로그 확인 등 |

---

## 📈 2. 캐릭터 성장 시스템 (Character Growth)

### 2.1. 기초 스탯 및 레벨업
*   **초기 스탯 (Lv.1)**: HP: 100, ATK: 10, DEF: 3, AS: 1.5
*   **성장치 (Lv 당)**: HP +30, ATK +2, DEF +0.5
*   **경험치 공식**: `다음 레벨 경험치 = 이전 목표 + (현재 레벨 * 10)`

### 2.2. 최종 스탯 계산 (Total Stat Formula)
1.  **공격력**: `(기본 + 합산고정) * (1 + 합산비율) * 유물배율 * 펫배율 * 스킬배율`
2.  **전투력(CP)**: `(공격력 * 2) + (방어력 * 1.5) + (최대체력 / 10)`
    *   *치명타 확률과 피해량 등 공격 기대값이 시각적 전투력에 반영됨*

---

## ⚔️ 3. 전투 및 엔진 상세 (Combat & Performance)

### 3.1. 전투 메커니즘
*   **Single Action Loop**: 한 턴에 오직 하나의 행동(스킬/기본공격)만 수행하여 프레임 안정성 확보. 몬스터 사망 시 즉시 리스폰되는 속도감 있는 루프.
*   **공격 직렬 처리 (v0.4.6)**: 연타 스킬 사용 시 모든 타격이 완전히 종료될 때까지 다음 공격 게이지 축적이 중지되어 타격감을 보장합니다.
*   **라운드 로빈 (Round Robin)**: 액티브 스킬을 습득 순서대로 순환 탐색하며, 사용 가능한 스킬이 없을 때만 기본 공격을 수행합니다.
*   **공격 속도 (AS)**: 
    *   **행동 간격**: `Interval(ms) = 1000 / 최종 AS`
    *   **하드캡**: 최소 간격 **167ms (최대 AS 6.0)** 제한.
*   **쾌속 등반 (Stage Jump)**: 몬스터를 1.5초 미만으로 처치 시 현재 스테이지 +1 이동. (보스 스테이지 제외)

### 3.2. 데미지 및 전투 공식 (Combat Formulas)

*   **최종 일반 데미지** = `(공격력 * 몬스터방어율) * 난수(0.9~1.1) * 최종피해배율 * 콤보배율`
    *   **일반 공격 콤보 배율** (Cycle: 4타)
        *   **1타**: 100% (1.0)
        *   **2타**: 130% (1.3)
        *   **3타**: 170% (1.7)
        *   **4타**: 220% (2.2)
    *   **콤보 리셋**: 4타 적중 후 1타 순환 또는 **스킬 사용 시 즉시 초기화**.
*   **최종 스킬 데미지** = `(공격력 * 스킬계수 * 몬스터방어율) * 난수(0.9~1.1) * 최종피해배율`
*   **최소 데미지 보장**: 공격력의 **10%**는 방어력과 관계없이 항상 적용.


---

## 👹 4. 몬스터 난이도 및 보상 (Monster Scaling)

몬스터 스탯은 스테이지(S)에 따라 3단계로 구분되어 성장합니다.

1.  **1구간 (S ≤ 200)**: `Multiplier = 1 + (S * 0.15)` [선형]
2.  **2구간 (200 < S ≤ 1500)**: `Multiplier = 31 * 1.065^((S-200)/10)` [지수]
3.  **3구간 (S > 1500)**: `Multiplier = 85000 * 1.1^((S-1500)/50) * (1 + Floor((S-1500)/100) * 0.5)` [강한 지수]

*   **보상 가속화**: `최종 보상 = 스테이지 기본 보상 * (1 + S / 500)`
*   **정예(Elite)**: 10% 확률 등장, 스탯 1.2~1.5배, 보상 2~5배 가중.

---

## 📦 5. 아이템 및 장비 시스템 (Equipment)

### 5.1. 등급별 드랍 확률 (7단계 표준)
| 등급 | 확률 | 보너스 배율 | 보조 옵션 개수 |
| :--- | :---: | :---: | :---: |
| **일반(Common)** | 82.0% | 1.0x | 1개 |
| **고급(Uncommon)** | 14.0% | 1.1x | 2개 |
| **희귀(Rare)** | 3.0% | 1.25x | 3개 |
| **영웅(Epic)** | 0.8% | 1.45x | 4개 |
| **고유(Unique)** | 0.15% | 1.55x | 5개 |
| **전설(Legendary)** | 0.04% | 1.7x | 6개 |
| **신화(Mythic)** | 0.01% | 2.0x | 6개 |

### 5.2. 강화 시스템 (Enhancement)
*   **슬롯 강화 (v0.3.0)**: 장착 슬롯 자체를 강화(0~3000 레벨). 장비 교체 시에도 수치 유지.
*   **아이템 개별 강화**: +20강까지 가능. 실패 시 내구도 고정 감소 (-5~-15).
*   **연속 실패 보호**: 3회 실패 시 내구도 감소 -50%, 6회 실패 시 내구도 감소 0 (파손 방지).
*   **승급(Promotion)**: +20강 장비를 재료와 소모하여 다음 티어 +10강으로 승급.

---

## 🔓 6. 성장 게이트 및 기능 해금 (Growth Gates)

| 기능 / 재료 | 해금 조건 (슬롯 강화 합) | 활성 조건 |
| :--- | :---: | :--- |
| **아이템 강화** | Lv. 50 | - |
| **옵션 재설정** | Lv. 300 | 숲 이상 지역 사냥 (재설정석 드랍) |
| **잠재능력 각성** | Lv. 1,000 | 광산 이상 지역 사냥 (큐브 드랍) |
| **T2 제작 해금** | Lv. 300 | 숲 지역 T2 구슬 드랍 시작 |
| **T3 제작 해금** | Lv. 1,000 | 광산 지역 T3 구슬 드랍 시작 |

---

## ✨ 7. 스킬 및 펫 시스템

### 7.1. 스킬 시스템
*   **바람 베기 (Lv.5)**: 70% x 3연타 (쿨 6초) - 초반 주력기
*   **광폭화 (Lv.10)**: 공속 증가 패시브 (기본 30% + Lv당 2.0%)
*   **쌍룡참 (Lv.25)**: 150% x 2연타 (쿨 10초) - v0.5.1 추가

### 7.2. 펫 시스템 (Pets)
*   **종류**: 총 30종 (일반~신화 등급별 5종)
*   **효과**: 보유 시 상시 스탯 상승(보유 효과) + 장착 시 특수 효과(동행 효과)
*   **소환 확률**: 신화 등급 0.05%

---

## 💤 8. 방치 및 효율 시스템 (Idle System)

*   **방치 기간**: 최대 24시간 누적 가능.
*   **보상 효율**: 실시간 측정된 분당 효율(GPM/EPM/KPM)의 **70%**를 오프라인 보상으로 지급.
*   **보정 로직**: 사냥터 이동 후 70초간 '예열(Warmup)' 단계를 거쳐 평균 효율을 정교하게 측정합니다.

---

## ♻️ 9. 분해 가이드 (Dismantle Guide)

### 9.1. 일괄/자동 분해 필터링 (Dual Filter)
*   **공식**: `(아이템 등급 <= 설정 등급) AND (아이템 티어 <= 설정 티어)`
*   **작동 방식**: 인벤토리 상단의 등급/티어 슬라이더를 통해 설정하며, 두 조건을 **모두 만족**하는 아이템만 분해 대상이 됩니다.
*   **자동 분해**: 아이템 획득 즉시 필터를 체크하여 인벤토리에 넣지 않고 바로 재료로 변환합니다.

---

## 🛠️ 10. 개발 가이드 및 프로젝트 아키텍처

### 8.1. 기술 스택
*   **Framework**: Flutter (Dart)
*   **State Management**: `Provider` + `GameState` (중앙 집중 관리)
*   **Database**: Supabase (Cloud Save / Auth)
*   **Storage**: Shared Preferences (Local Save)

### 8.2. 프로젝트 구조
*   `lib/providers/game_state.dart`: 게임의 모든 비즈니스 로직 및 상태 관리
*   `lib/models/`: 데이터 모델 (Item, Player, Monster, Pet, Skill 등)
*   `lib/widgets/`: 모듈화된 UI 위젯 (각 탭 및 시스템 패널)
*   `lib/services/`: 외부 서비스 연동 (Auth, CloudSave, Update)

### 8.3. 배포 및 업데이트 (CI/CD)
*   GitHub Actions를 사용해 코드 푸시 시 자동으로 APK 빌드 및 `version.json` 갱신.
*   앱 실행 시 서버의 `version.json`을 분석하여 인앱 업데이트 알림 출력.

### 8.4. 실기기 테스트 (Android USB)
1.  개발자 옵션 -> USB 디버깅 활성화
2.  `flutter devices`로 기기 인식 확인
3.  `flutter run --release`로 하드웨어 성능 테스트 권장

---

## 📋 11. 프로젝트 로드맵 (Roadmap)

### 🔴 Short-term (안정화)
- [ ] **메모리 최적화**: 저사양 기기에서의 텍스트 렌더링 부하 추가 절감
- [ ] **사운드 시스템**: 배경음(BGM) 및 타격 효과음 적용
- [ ] **시스템 설정**: 초기화 기능, 닉네임 변경 및 계정 관리 UI 완성

### 🟡 Mid-term (콘텐츠 확장)
- [ ] **유물 시스템 (Prestige)**: 환생 시 획득하는 영구 버프 스탯 도입
- [ ] **무한의 탑**: 보스 처치 기록에 따른 랭킹 시스템
- [ ] **특수 던전**: 요일별 재화 획득 전용 던전

### 🟢 Long-term (소셜 및 완성)
- [ ] **길드 시스템**: 협동 공격력 버프 및 길드 전용 사냥터
- [ ] **랭킹 데시보드**: 전 세계 유저와 실시간 투력 비교
- [ ] **다국어 지원**: 영어 및 일본어 대응

---

## 📞 문의 및 피드백
*   **버전**: v0.5.6 (Integrated)
*   **마지막 업데이트**: 2026-01-24

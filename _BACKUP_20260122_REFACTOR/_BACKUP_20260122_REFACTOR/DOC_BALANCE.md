# 🎮 몬스터 난이도 곡선 및 전투 밸런스 설계

> 목표: 스테이지 진행에 따른 명확한 성장 체감 및 후반부 도전 과제 제공

## 📊 새로운 성장 시스템 (최신 반영)

### 🎯 **기본 원칙**
- **기하급수적 성장**: 특정 구간을 기점으로 난이도가 급상승하여 성장의 필요성 강조
- **Soft Cap 방어력**: 방어력이 무한히 높아져도 최소 데미지를 입도록 설계
- **쾌속 등반**: 압도적인 스펙 차이 발생 시 스테이지를 빠르게 건너뜀

### 📈 **성장 및 전투 공식**

#### 1. 몬스터 베이스 스탯 (Base Stats)
모든 몬스터는 아래의 베이스 범위 내에서 스탯이 결정된 후 스테이지 배율이 곱해집니다.

**일반 몬스터 (Normal)**
- **HP**: 60 ~ 100
- **공격력 (ATK)**: 8 ~ 14
- **방어력 (DEF)**: 3 ~ 6
- **보상 (Gold/EXP)**: 20~35 / 15~25

**보스 몬스터 (Boss - 매 50층)**
- **등장 조건**: 매 50 스테이지의 **마지막(10번째)** 몬스터로 출현
- **HP**: 800
- **공격력 (ATK)**: 35
- **방어력 (DEF)**: 15
- **보상 (Gold/EXP)**: 500 / 500

**엘리트 몬스터 (Elite)**
- **HP**: 일반 베이스 x 1.5
- **공격력 (ATK)**: 일반 베이스 x 1.3
- **방어력 (DEF)**: 일반 베이스 x 1.2
- **보상 (Gold/EXP)**: 일반 베이스 x 2~5배 (랜덤)

#### 2. 몬스터 성장 배율 (Stage Scaling)
스테이지(S)에 따라 최종 배율(Multiplier)이 결정됩니다.

1. **1구간 (S ≤ 200)**: `배율 = 1 + (S * 0.15)` [선형]
   - *초반 성장의 재미를 느끼게 하는 구간*
2. **2구간 (200 < S ≤ 1500)**: `배율 = 31 * 1.065^((S-200)/10)` [지수]
   - *본격적인 장비 강화의 효율이 나타나는 구간*
3. **3구간 (S > 1500)**: `배율 = 85000 * 1.1^((S-1500)/50) * (1 + Floor((S-1500)/100) * 0.5)` [강한 지수 + 벽]
   - *최종 한계 돌파를 요구하는 엔드 콘텐츠 구간*

#### 3. 보상 가속화 배율 (Reward Acceleration)
고스테이지로 갈수록 성장의 속도를 맞추기 위해 골드와 경험치 보상에 추가 배율이 적용됩니다.
- **공식**: `최종 보상 배율 = 스테이지 배율 * (1 + S / 500)`
- *이 가속화는 몬스터의 체력/공격력과는 무관하게 오직 보상량에만 영향을 줍니다.*

#### 4. 전투 데미지 공식 (Soft Cap)
- **데미지 배율**: `100 / (100 + 방어력)`
- **최종 데미지**: `공격력 * 데미지 배율 * (최종 피해량 증폭)`
- **최소 데미지**: 공격력의 **10%**는 항상 보장

### 5. ⚔️ 공격 속도 및 전투 턴 시스템

공격 속도는 캐릭터의 행동 주기를 결정하는 핵심 스탯입니다.

- **시스템 정의**: 초당 공격 횟수를 늘리는 방식이 아닌, **"행동 간격(Action Interval)"을 단축**하는 방식입니다.
- **최종 공속 공식**: `1.0(기본) + 패시브 스킬 + 펫 동행 효과 + 장비 옵션/잠재능력`
- **턴 간격 계산**: `인터벌(ms) = 1000 / 최종 공속`
- **하드캡 (Hard Cap)**:
  - 전투 엔진의 안정성을 위해 행동 간격은 **최소 250ms (초당 4회)**로 제한됩니다.
  - 플레이어 최종 공속은 최대 **4.0**으로 제한됩니다.
- **성장 설계 (최종 4.0 타겟)**:
  - **기본값**: 1.0
  - **스킬/펫**: 약 +2.0 (광폭화 100lv 시 +1.5, 고등급 펫 동행 시 +0.5)
  - **아이템**: 6부위 합계 약 +1.8 (T6 극옵 기준 부위당 약 0.3)
  - **자유도**: 이론적 합계는 4.8로, 하드캡(4.0)을 넘기기 쉬워짐에 따라 일부 장비 부위에서 치명타/공격력 등 다른 옵션을 선택할 수 있는 전략적 자유를 제공합니다.
- **행동 우선순위 (Round Robin)**:
  1. **액티브 스킬**: 사용 가능한 스킬이 있다면 라운드 로빈 순번에 따라 즉시 실행.
  2. **기본 공격**: 모든 스킬이 쿨타임인 경우에만 수행.

### 6. 📦 아이템 획득 및 시스템 개편 (v0.0.59)

| 구분 | **티어 (Tier, 1~6단계)** | **등급 (Grade, 일반~신화)** |
| :--- | :--- | :--- |
| **의미** | 아이템의 '세대(성장도)' | 아이템의 '품질(희귀도)' |
| **획득 방식** | **T1만 드랍**, T2 이상은 **제작/승급** 전용 | 드랍 시 랜덤 확률 결정 |
| **핵심 역할** | **주능력치 및 보조 옵션 수치** 결정 | **보조 옵션 개수** 결정 (1~6개) |
| **성장 방식** | 제작을 통한 상위 티어 획득 | 승급을 통한 품질(등급) 개선 |

#### 6.1. 등급별 드랍 확률 (고정)
*   일반(Common): 60%
*   고급(Uncommon): 25%
*   희귀(Rare): 10%
*   에픽(Epic): 4%
*   전설(Legendary): 0.9%
*   신화(Mythic): 0.1%

#### 6.2. 티어 및 품질 기반 수치 설계 (v0.0.58 기준값 준수)
*   **성장 모델**: 티어당 **4.0배** exponential 성장 (베이스: T1 무기 ATK 12 등).
*   **강화 효율**: 주능력치에 대해 **복리** 증가 (1~17강 12%, 18강+ 6%).
*   **보조 옵션 개수**: 등급에 따라 일반(1개) ~ 신화(6개) 결정.

#### 6.3. 성장 게이트 (Gate System)
상위 티어 장비 제작을 위한 **핵심 재료(심연의 구슬)**는 플레이어의 현재 스펙(평점)에 따라 몬스터가 드랍하기 시작합니다.

| 목표 티어 | 핵심 재료 (Monster Drop) | 드랍 활성화 조건 | 드랍 확률 |
| :--- | :--- | :--- | :--- |
| **Tier 2** | 심연의 구슬 [T2] | 장착 아이템 **평균 +13강** 이상 | 3% |
| **Tier 3** | 심연의 구슬 [T3] | 장착 아이템 **평균 +15강** 이상 | 1% |
| **Tier 4** | 심연의 구슬 [T4] | 장착 아이템 **평균 +18강** 이상 | 0.5% |

#### 6.4. 분해 및 파편 보상 (Shard System)
아이템 분해 시 해당 티어의 **파편(Shard)**을 획득하며, 이는 상위 티어 제작의 기본 재료가 됩니다.
*   **일반**: 1개
*   **고급**: 3개
*   **희귀**: 10개
*   **에픽**: 30개
*   **전설**: 100개
*   **신화**: 500개

#### 6.5. 사냥 재료 드랍 (Material Drops)
사냥터에서 몬스터 처치 시 낮은 확률로 강화석 및 가루를 획득합니다. (v0.1.16 반영)
*   **강화석**: 확률 10%, 수량 `1 + (MonsterLv / 50) + Random(0~2)`
*   **신비로운 가루**: 확률 40%, 수량 `(MonsterLv / 5) + Random(0~9)`
*   **설계 의도**: 드랍을 통한 수급을 제한하여 장비 분해의 가치를 높이고 재화 인플레이션 방지.

---

## 🛠️ **구현 코드 레퍼런스**

### 몬스터 생성 (lib/models/monster.dart)
성장 공식에 따라 `multiplier`를 계산하고 캐릭터 레벨에 따른 기반 스탯에 곱하여 생성합니다.

### 전투 처리 (lib/main.dart)
`_startBattleLoop`와 `_processCombatTurn` 내에서 공속 기반 턴 제어 및 라운드 로빈 스킬 로직을 수행합니다.

---

## ✅ **밸런스 체크포인트**

- **초반 (1~200)**: 선형 성장을 통해 게임 시스템에 적응하고 쾌속 등반을 경험하게 함.
- **중반 (201~1500)**: 지수 성장이 시작되어 장비 강화 및 스킬 투자의 효율이 느껴짐.
- **후반 (1501~)**: 강한 지수 성장이 발생하며, 유물(환생) 및 최고 단계 강화가 필수적인 구간.

---

## 🎯 **결론**

이 밸런스는 플레이어에게 끊임없는 성장 동기를 부여하며, 단순한 수치 싸움을 넘어선 복합적인 성장을 유도합니다.
